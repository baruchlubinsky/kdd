<!DOCTYPE html>
<html>
<div id="myplot"></div>
<script type="module">

import * as Plot from "https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6/+esm";
import {json} from "https://cdn.skypack.dev/d3-fetch@3";

json("/api/apps/budget/month_to_date", {timeout: 0})
.then((data) => {
    var angle = 0;
    if (data.length > 12) {
        angle = 15;
    }
    if (data.length > 18) {
        angle = 30;
    }
    const plot = Plot.plot({
        color: {"legend": true},
        marginBottom: 40,
        x: {"axis": null},
        marks: [
            Plot.barY(data, Plot.groupX({y: "identity"}, {x: "type", fx: "category", y: "value", fill: "type"})),
            Plot.axisFx({anchor: "bottom", tickRotate: angle, label: null, textAnchor: "centre"}),
            Plot.ruleY([0])
        ]
    });
    const div = document.querySelector("#myplot");
    var heading = document.createElement("h3");
    heading.innerHTML = "Monthly spend (work-in-progress)";
    heading.style.fontFamily = "system-ui";
    heading.style.fontWeight = "normal";

    div.append(heading);
    div.append(plot);
});

</script>
</html>
